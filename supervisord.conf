[supervisord]
nodaemon=true
user=user
logfile=/dev/null
logfile_maxbytes=0
pidfile=/var/run/supervisord.pid

[program:redis]
command=/usr/bin/redis-server --port 6379 --bind 127.0.0.1 --daemonize no
priority=10
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=2

[program:django]
command=gunicorn core.wsgi:application --bind 0.0.0.0:7860 --workers 2 --timeout 120 --access-logfile - --error-logfile -
directory=/app
priority=20
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=5
; Wait for Redis to be ready
startretries=5

[program:celery-worker]
command=celery -A core worker -l info --concurrency=2 --max-tasks-per-child=50
directory=/app
priority=30
autostart=true
autorestart=true
stopwaitsecs=60
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=10
; Graceful shutdown
stopasgroup=true
killasgroup=true
